<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title>高频模式</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../font_icon/iconfont.css" rel="stylesheet" />
		<link href="../css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/icons-extra.css" />
		<link href="../css/app.css" rel="stylesheet" />
		<link href="../css/mui.picker.css" rel="stylesheet" />
		<link href="../css/mui.poppicker.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="../css/mui.picker.min.css" />
		<style>
			.mui-btn {
				font-size: 16px;
				padding: 8px;
				margin: 3px;
			}
			h5.mui-content-padded {
				margin-left: 3px;
				margin-top: 20px !important;
			}
			h5.mui-content-padded:first-child {
				margin-top: 12px !important;
			}
			.ui-alert {
				text-align: center;
				padding: 20px 10px;
				font-size: 16px;
			}
			#alert-content {
				width: 0px;
				height: 0px;
				position: fixed;
				top: 70%;
				left: 50%;
			}
			/*移除底部或顶部三角,需要在删除此代码*/
			.mui-popover .mui-popover-arrow:after {
				width: 0px;
			}
			
		</style>
	</head>
		
	<body>
			<header id="header" class="mui-bar mui-bar-nav backwhite shadow0">
				<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left col333"></a>
				<h1 class="mui-title col333">高频</h1>
			</header>
			
			
			<div class="mui-content">
				
				<div class="my-device">
					
					<!-- 高频 -->
					<!-- <form class="mui-input-group timing" method="post" onsubmit="return verification()"> -->
					<form class="timing" method="post" onsubmit="return verification()">
						<div class="module">
							<p class="amblist col333">当前状态</p>
							<ul class="device-ul">
								<li class="mui-card bor-radius5">
									<div class="mui-card-header">当前状态
										<!-- <span class="fr execu-change colgrey fosize09 high-detail">查看详情</span> -->
									</div>
									<div class="mui-card-content">
										<div class="mui-card-content-inner">
											<ul class="mui-table-view">
												<li class="mui-table-view-cell padd0" id="type-name-li">
													<label class="fl fosize09 list-form-name">当前状态</label>
													
													<a class="mui-icon mui-icon-arrowright form-icon colgrey fr" style="line-height:60px !important;"></a>
													<input type="text" class="mui-input-clear colgrey fosize09 fl share-input" name=""  value="日间方案"  id='type-name'>
												</li>
											</ul>
										</div>
									</div>
								</li>
							</ul>
						</div>
						<div class="module">
							<p class="amblist col333">方案选择</p>
							<ul class="device-ul">
								<li class="mui-card bor-radius5">
									<div class="mui-card-header">方案选择
										<span class="fr execu-change colgrey fosize09 high-detail">查看详情</span>
									</div>
									<div class="mui-card-content">
										<div class="mui-card-content-inner">
											<ul class="mui-table-view">
												<li class="mui-table-view-cell padd0" id="type-name-li">
													<label class="fl fosize09 list-form-name">当前方案</label>
													
													<a class="mui-icon mui-icon-arrowright form-icon colgrey fr" style="line-height:60px !important;"></a>
													<input type="text" class="mui-input-clear colgrey fosize09 fl share-input" name=""  value="日间方案"  id='type-name'>
												</li>
												
											</ul>
											<div class="mui-button-row">
												<button type="button" class="mui-btn mui-btn-primary warn-btn  w45 zhixing-model" >执行</button>
												<button type="button" class="mui-btn mui-btn-danger warn-btn  w45 delete-model" >删除</button>
											</div>
										</div>
									</div>
								</li>
							</ul>
						</div>
						<div class="module">
							<p class="amblist col333">时间周期设置</p>
							<ul class="device-ul">
								<li class="mui-card bor-radius5">
									<div class="mui-card-header">时间周期</div>
									<div class="mui-card-content">
										<div class="mui-card-content-inner">
											<ul class="mui-table-view">
												<li class="mui-table-view-cell padd0" id="timing-name-li">
													<label class="fl fosize09 list-form-name">设备</label>
													<a class="mui-icon mui-icon-arrowright form-icon colgrey fr" style="line-height:60px !important;"></a>
													<input type="text" class="v_empty mui-input-clear colgrey fosize09 fl share-input" name="timing-name"  value=""  id='timing-name'>
												</li>
												<li class="mui-table-view-cell padd0" id="timing-startday-li" data-options='{}'>
													<label class="fl fosize09 list-form-name">开启时间</label>
													<a class="mui-icon mui-icon-arrowright form-icon colgrey fr" style="line-height:60px !important;"></a>
													<input type="text" class="v_empty mui-input-clear colgrey fosize09 fl share-input" name="timing-startday"  value=""  id='timing-startday'>
												</li>
												<li class="mui-table-view-cell padd0" id="timing-endday-li" data-options='{}'>
													<label class="fl fosize09 list-form-name">关闭时间</label>
													<a class="mui-icon mui-icon-arrowright form-icon colgrey fr" style="line-height:60px !important;"></a>
													<input type="text" class="v_empty mui-input-clear colgrey fosize09 fl share-input" name="timing-endday"  value=""  id='timing-endday'>
												</li>
												<li class="mui-table-view-cell padd0">
													<label class="fl fosize09 list-form-name">灌溉(分)</label>
													<input type="text" class="v_empty mui-input-clear colgrey fosize09 fl reg-input" name=""  value="">					
												</li>
												<li class="mui-table-view-cell padd0">
													<label class="fl fosize09 list-form-name">间隔(分)</label>
													<input type="text" class="v_empty mui-input-clear colgrey fosize09 fl reg-input" name=""  value="">					
												</li>
											</ul>
											<div class="mui-button-row">
												<!-- <button type="button" class="mui-btn mui-btn-primary warn-btn" >确认</button> -->
												<button type="submit" class="mui-btn mui-btn-primary warn-btn" >添加</button>
											</div>
										</div>
									</div>
								</li>
							</ul>
						</div>
						<div class="module">
							<p class="amblist col333">已添加模式
								<span class="fr colju" id="high-preserve">保存模式</span>
							</p>
							<ul class="device-ul">
								<li class="mui-card">
									<div class="mui-card-header execu-title fosize09 ">
										<a  class="mui-icon mui-icon-settings fosize1 fl colblue"><span class="colblue ml5">设备do1</span></a>
										<!-- <span class="fr execu-change">修改计划</span> -->
									</div>
									<div class="mui-card-content">
										<div class="mui-card-content-inner">
											<p>开启时间:2018-12-02 00:00:00
												<span class="execu-status ml5 fr">
													<span class="icon iconfont icon-open colju fosize1"></span>
														<span class="fosize08 col333">开启超时</span>
													<!-- </a> -->
												</span>
											</p>
											<p>关闭时间:2018-12-02 00:00:00
												<span class="execu-status ml5 fr">
													<span class="icon iconfont icon-open colju fosize1"></span>
														<span class="fosize08 col333">未关闭</span>
													<!-- </a> -->
												</span>
											</p>
											
											<!-- <p>最近执行:2020-08-10 00:00</p> -->
											<p class="porelative">
												<span class="fl">灌溉时间:20</span>
												<span class="fr">间隔时间:20</span>
											</p>
										</div>
									</div>
									<div class="mui-card-footer  execu-title fosize09 ">
											<span class="fl">最近执行:2020-08-10 00:00</span>
											<span class="fr execu-jilu colju delete">删除</span>
									</div>
								</li>
								<li class="mui-card">
									<div class="mui-card-header execu-title fosize09 ">
										<a  class="mui-icon mui-icon-settings fosize1 fl colblue"><span class="colblue ml5">设备do1</span></a>
										<!-- <span class="fr execu-change">修改计划</span> -->
									</div>
									<div class="mui-card-content">
										<div class="mui-card-content-inner">
											<p>开启时间:2018-12-02 00:00:00
												<span class="execu-status ml5 fr">
													<span class="icon iconfont icon-open colju fosize1"></span>
														<span class="fosize08 col333">开启超时</span>
													<!-- </a> -->
												</span>
											</p>
											<p>关闭时间:2018-12-02 00:00:00
												<span class="execu-status ml5 fr">
													<span class="icon iconfont icon-open colju fosize1"></span>
														<span class="fosize08 col333">未关闭</span>
													<!-- </a> -->
												</span>
											</p>
											
											<!-- <p>最近执行:2020-08-10 00:00</p> -->
											<p class="porelative">
												<span class="fl">灌溉时间:20</span>
												<span class="fr">间隔时间:20</span>
											</p>
										</div>
									</div>
									<div class="mui-card-footer  execu-title fosize09 ">
											<span class="fl">最近执行:2020-08-10 00:00</span>
											<span class="fr execu-jilu colju delete">删除</span>
									</div>
								</li>
							</ul>
						</div>
					
					
						
					</form>
					
					
				</div>
				<!-- 弹出框 模式详情-->
				<div id="alert-content" class="alert-content"></div>
				<div id="popover" class="mui-popover sys-popover" style="height:330px;">
				   <div class="mui-popover-arrow"></div>
					<div class="sys-pop-title">测试测试</div>
					<div class="sys-pop-content">
						<div class="mui-scroll-wrapper">
							<div class="mui-scroll">
								<div>
								通知内容通知内容通知内容通知内容通知内容通知内容通知内容通知内容通知内容通知内容通知内容
								</div>
							</div>
						</div>
					</div>
					<div class="sys-pop-close">
					<button type="button" class="mui-btn mui-btn-primary sys-pop-btn" >我知道了</button>
					</div>
					<p class="sys-pop-time">2020-07-24 23:29</p>
				</div>
				<!-- 结束 -->
				
			</div>
			
			
			
			
		<script src="../js/mui.min.js"></script>
		<script src="../js/mui.view.js "></script>
		<script src="../js/mui.picker.js"></script>
		<script src="../js/mui.picker.min.js"></script>
		<script src="../js/mui.poppicker.js"></script>
		<script src="../js/city.data.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/city.data-3.js" type="text/javascript" charset="utf-8"></script>
		
		<script type="text/javascript">
			mui.init();
			mui('.mui-scroll-wrapper').scroll();
			
			mui(".mui-card").on("tap",".high-detail",function(){
				mui.openWindow({
					url: 'highDetail.html', 
					id:'change'
				});
			});
			//执行模式弹框
			mui(".mui-button-row").on("tap",".zhixing-model",function(){
				mui.confirm('是否执行','请确认',['否','是'],function (e) {
					if (e.index == 1) {
						mui.toast('已执行');
						// mui.openWindow({
						// 	url: 'shareList.html', 
						// 	id:'info'
						// });
					} else {
						
					}
				},'div')
			});
			//删除模式弹框
			mui(".mui-button-row").on("tap",".delete-model",function(){
				mui.confirm('是否删除','请确认',['否','是'],function (e) {
					if (e.index == 1) {
						mui.toast('已删除');
						// mui.openWindow({
						// 	url: 'shareList.html', 
						// 	id:'info'
						// });
					} else {
						
					}
				},'div')
			});
			
			// 弹出框 模式详情
			// mui(".mui-card-header").on("tap",".high-detail",function(){
			// 	mui("#popover").popover('toggle', document.getElementById("alert-content"));
			// });
			// mui(".sys-pop-close").on("tap",".sys-pop-btn",function(){
			// 	mui("#popover").popover('toggle', document.getElementById("alert-content"));
			// });
			// 删除弹框
			mui(".mui-card-footer").on("tap",".delete",function(){
				mui.confirm('是否删除','请确认',['否','是'],function (e) {
					if (e.index == 1) {
						mui.toast('已删除');
						// mui.openWindow({
						// 	url: 'shareList.html', 
						// 	id:'info'
						// });
					} else {
						
					}
				},'div')
			});
			
			//保存模式
			document.getElementById("high-preserve").addEventListener('tap', function(e) {
				e.detail.gesture.preventDefault(); //修复iOS 8.x平台存在的bug，使用plus.nativeUI.prompt会造成输入法闪一下又没了
				var btnArray = ['取消', '确定'];
				mui.prompt('', '模式名称', '请输入模式名', btnArray, function(e) {
					if (e.index == 1) {
						console.log(e.value);//输入框的值
						mui.toast('已保存');
					} else {
						 
					}
				})
			});
						
						
			(function($, doc) {
				$.init();
				$.ready(function() {
					/**
					 * 获取对象属性的值
					 * 主要用于过滤三级联动中，可能出现的最低级的数据不存在的情况，实际开发中需要注意这一点；
					 * @param {Object} obj 对象
					 * @param {String} param 属性名
					 */
					var _getParam = function(obj, param) {
						return obj[param] || '';
					};
					
					//选择模式
					var typeName = new $.PopPicker();
					typeName.setData([{
						value: 'dingshi',
						text: '无'
					}, {
						value: 'gaopin',
						text: '日间方案'
					}]);
					var showtypeName = doc.getElementById('type-name-li');
					var usertypeName = doc.getElementById('type-name');
					showtypeName.addEventListener('tap', function(event) {
						typeName.show(function(items) {
							//数据为items[0]
							// usertypeName.innerText = JSON.stringify(items[0]);
							//显示文本
							usertypeName.value = items[0].text;
							//返回 false 可以阻止选择框的关闭
							//return false;
						});
					}, false);
					
					//选择设备
					var timingName = new $.PopPicker();
					timingName.setData([{
						value: 'dingshi',
						text: '设备1'
					}, {
						value: 'gaopin',
						text: '设备2'
					}]);
					var showtimingName = doc.getElementById('timing-name-li');
					var usertimingName = doc.getElementById('timing-name');
					showtimingName.addEventListener('tap', function(event) {
						timingName.show(function(items) {
							//数据为items[0]
							// usertimingName.innerText = JSON.stringify(items[0]);
							//显示文本
							usertimingName.value = items[0].text;
							//返回 false 可以阻止选择框的关闭
							//return false;
						});
					}, false);
					
					
					
					// 开始日期
					var startday = $('#timing-startday')[0];
					var startdayText = $('#timing-startday-li');
					startdayText.each(function(i, btn) {
						btn.addEventListener('tap', function() {
							var _self = this;
							if(_self.picker) {
								_self.picker.show(function (rs) {
									// startday.value = '选择结果: ' + rs.text;
									_self.picker.dispose();
									_self.picker = null;
								});
							} else {
								var optionsJson = this.getAttribute('data-options') || '{}';
								var options = JSON.parse(optionsJson);
								var id = this.getAttribute('id');
								
								_self.picker = new $.DtPicker(options);
								_self.picker.show(function(rs) {
									
									startday.value = rs.text;
									
									/*
									 * 释放组件资源，释放后将将不能再操作组件
									 */
									_self.picker.dispose();
									_self.picker = null;
								});
							}
							
						}, false);
					});
					
					// 关闭日期
					var endday = $('#timing-endday')[0];
					var enddayText = $('#timing-endday-li');
					enddayText.each(function(i, btn) {
						btn.addEventListener('tap', function() {
							var _self = this;
							if(_self.picker) {
								_self.picker.show(function (rs) {
									// endday.value = '选择结果: ' + rs.text;
									_self.picker.dispose();
									_self.picker = null;
								});
							} else {
								var optionsJson = this.getAttribute('data-options') || '{}';
								var options = JSON.parse(optionsJson);
								var id = this.getAttribute('id');
								
								_self.picker = new $.DtPicker(options);
								_self.picker.show(function(rs) {
									
									endday.value = rs.text;
									
									_self.picker.dispose();
									_self.picker = null;
								});
							}
							
						}, false);
					});
					
					// 开启时间
					var start = $('#timing-start')[0];
					var startText = $('#timing-start-li');
					startText.each(function(i, btn) {
						btn.addEventListener('tap', function() {
							var _self = this;
							if(_self.picker) {
								_self.picker.show(function (rs) {
									// start.value = '选择结果: ' + rs.text;
									_self.picker.dispose();
									_self.picker = null;
								});
							} else {
								var optionsJson = this.getAttribute('data-options') || '{}';
								var options = JSON.parse(optionsJson);
								var id = this.getAttribute('id');
								
								_self.picker = new $.DtPicker(options);
								_self.picker.show(function(rs) {
									
									start.value = rs.text;
									
									_self.picker.dispose();
									_self.picker = null;
								});
							}
							
						}, false);
					});
					
					// 关闭时间
					var end = $('#timing-end')[0];
					var endText = $('#timing-end-li');
					endText.each(function(i, btn) {
						btn.addEventListener('tap', function() {
							var _self = this;
							if(_self.picker) {
								_self.picker.show(function (rs) {
									// end.value = '选择结果: ' + rs.text;
									_self.picker.dispose();
									_self.picker = null;
								});
							} else {
								var optionsJson = this.getAttribute('data-options') || '{}';
								var options = JSON.parse(optionsJson);
								var id = this.getAttribute('id');
								
								_self.picker = new $.DtPicker(options);
								_self.picker.show(function(rs) {
									
									end.value = rs.text;
									
									_self.picker.dispose();
									_self.picker = null;
								});
							}
							
						}, false);
					});
				});
				
			})(mui, document);

			function getTime(date_str) {
				return !date_str?new Date().getTime():new Date(date_str.replace(/-/g,'/')).getTime();
			}
			function is_empty() {
				var is_sub = false;
				var input = document.querySelectorAll('.v_empty');
				input.forEach(function (item,i) {
					if(item.value===''){
						is_sub=true;
					}
				});
				return is_sub
			}
			function verification() {
				var start_date = document.getElementById('timing-startday').value;
				var end_date = document.getElementById('timing-endday').value;
				// var start_time = document.getElementById('timing-start').value;
				// var end_time = document.getElementById('timing-end').value;
				if(is_empty()){
					mui.toast('不能为空');
					return false
				}
				// if(getTime(start_date)<getTime()){
				// 	mui.toast('开始日期不能小于当前日期');
				// 	return false
				// }
				if(getTime(start_date)>getTime(end_date)){
					mui.toast('开启时间不能大于关闭时间');
					return false
				}
				// if(Number(start_time.replace(/:/g,''))>Number(end_time.replace(/:/g,''))){
				// 	mui.toast('开启时间不能大于关闭时间');
				// 	return false
				// }
				return true
			}
			 
			
			
		</script>
	</body>

</html>
